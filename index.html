<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SIMPLE BISNIS - Cyber Network</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        /* -------------------------------------------------------------------
        CYBER-NETWORK THEME CSS
        ------------------------------------------------------------------- */
        
        /* CSS Reset & Variables */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --primary: #00f0ff;
            --secondary: #ff00aa;
            --accent: #00ff88;
            --dark: #0a0a1a;
            --darker: #050510;
            --card-bg: #111128;
            --text: #ffffff;
            --text-secondary: #a0a0c0;
            --danger: #ff2a6d;
            --warning: #ffcc00;
            --success: #00ff88;
        }

        /* Loading Screen */
        #loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--darker);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s ease;
            overflow: hidden;
        }

        .loading-container {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .loading-background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 30%, rgba(0, 240, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(255, 0, 170, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 80%, rgba(0, 255, 136, 0.1) 0%, transparent 50%);
            z-index: -1;
        }

        .loading-logo {
            font-size: 3.5rem;
            margin-bottom: 2rem;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 3px;
            position: relative;
            z-index: 2;
        }

        .loading-logo-text {
            background: linear-gradient(45deg, var(--primary), var(--secondary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            position: relative;
            display: inline-block;
        }

        .loading-logo-text::after {
            content: "";
            position: absolute;
            bottom: -10px;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg, var(--primary), var(--secondary), var(--accent));
            border-radius: 2px;
        }

        .loading-subtitle {
            color: var(--text-secondary);
            font-size: 1rem;
            margin-bottom: 3rem;
            text-align: center;
            max-width: 80%;
            line-height: 1.5;
        }

        .hologram-container {
            position: relative;
            width: 200px;
            height: 200px;
            margin-bottom: 2rem;
            perspective: 1000px;
        }

        .hologram {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: 
                radial-gradient(circle at 30% 30%, rgba(0, 240, 255, 0.8) 0%, transparent 50%),
                radial-gradient(circle at 70% 70%, rgba(255, 0, 170, 0.6) 0%, transparent 50%);
            box-shadow: 
                0 0 50px rgba(0, 240, 255, 0.5),
                inset 0 0 50px rgba(0, 240, 255, 0.2);
            animation: hologram-rotate 8s linear infinite, hologram-pulse 3s ease-in-out infinite alternate;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .hologram-inner {
            width: 60%;
            height: 60%;
            border-radius: 50%;
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(5px);
            border: 1px solid rgba(0, 240, 255, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            color: var(--primary);
            font-size: 2rem;
            animation: hologram-inner 4s linear infinite;
        }

        .loading-progress-container {
            width: 300px;
            margin-top: 2rem;
        }

        .loading-progress-text {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .loading-progress {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            overflow: hidden;
            position: relative;
        }

        .loading-bar {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, var(--primary), var(--secondary), var(--accent));
            transition: width 0.3s ease;
            position: relative;
        }

        .loading-bar::after {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.5), transparent);
            animation: loading-shine 2s infinite;
        }

        .loading-dots {
            display: flex;
            gap: 5px;
            margin-top: 1rem;
        }

        .dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--primary);
            animation: dot-pulse 1.5s infinite ease-in-out;
        }

        .dot:nth-child(2) {
            animation-delay: 0.2s;
            background: var(--secondary);
        }

        .dot:nth-child(3) {
            animation-delay: 0.4s;
            background: var(--accent);
        }

        @keyframes hologram-rotate {
            0% { transform: rotateY(0deg) rotateX(0deg); }
            100% { transform: rotateY(360deg) rotateX(360deg); }
        }

        @keyframes hologram-pulse {
            0% { transform: scale(1); opacity: 0.8; }
            100% { transform: scale(1.05); opacity: 1; }
        }

        @keyframes hologram-inner {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes loading-shine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        @keyframes dot-pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.5); opacity: 0.7; }
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(0, 240, 255, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(0, 240, 255, 0); }
            100% { box-shadow: 0 0 0 0 rgba(0, 240, 255, 0); }
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--darker) 0%, var(--dark) 100%);
            color: var(--text);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Header */
        .cyber-header {
            background: rgba(10, 10, 26, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 2px solid var(--primary);
            padding: 1rem 2rem;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1400px;
            margin: 0 auto;
        }

        .logo { 
            display: flex; 
            align-items: center; 
            gap: 1rem; 
            position: relative;
        }
        
        .logo-icon { 
            font-size: 1.8rem; 
            color: var(--primary); 
            animation: pulse 2s infinite;
            position: relative;
            z-index: 2;
        }
        
        .logo-icon::before {
            content: "";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 40px;
            height: 40px;
            background: radial-gradient(circle, rgba(0, 240, 255, 0.3) 0%, transparent 70%);
            border-radius: 50%;
            z-index: -1;
        }
        
        .logo-text { 
            font-size: 1.8rem; 
            font-weight: 900; 
            text-transform: uppercase;
            letter-spacing: 1px;
            background: linear-gradient(45deg, var(--primary), var(--secondary), var(--accent));
            -webkit-background-clip: text; 
            -webkit-text-fill-color: transparent;
            position: relative;
            padding-right: 10px;
        }
        
        .logo-text::after {
            content: "";
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, var(--primary), var(--secondary), var(--accent));
            border-radius: 1px;
        }

        .nav-tabs { 
            display: flex; 
            gap: 0.5rem; 
            position: relative;
        }
        
        .cyber-tab {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(0, 240, 255, 0.3);
            color: var(--text);
            padding: 0.8rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex; 
            align-items: center; 
            gap: 0.5rem;
            position: relative;
            overflow: hidden;
            font-weight: 600;
            letter-spacing: 0.5px;
            text-transform: uppercase;
            font-size: 0.8rem;
        }
        
        .cyber-tab::before {
            content: "";
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 240, 255, 0.2), transparent);
            transition: left 0.5s;
        }
        
        .cyber-tab:hover::before {
            left: 100%;
        }
        
        .cyber-tab:hover { 
            background: rgba(0, 240, 255, 0.1); 
            border-color: var(--primary); 
            box-shadow: 0 0 15px rgba(0, 240, 255, 0.3);
            transform: translateY(-2px);
        }
        
        .cyber-tab.active { 
            background: rgba(0, 240, 255, 0.2); 
            border-color: var(--primary); 
            box-shadow: 0 0 10px rgba(0, 240, 255, 0.5), inset 0 0 10px rgba(0, 240, 255, 0.1);
        }

        /* Main Layout */
        .main-container {
            max-width: 1400px;
            margin: 1rem auto;
            padding: 0 1rem;
            height: calc(100vh - 100px);
            position: relative;
        }
        
        @media (max-width: 768px) {
            .main-container { padding: 0; margin-top: 0; height: calc(100vh - 140px); }
            
            .loading-logo {
                font-size: 2.5rem;
            }
            
            .hologram-container {
                width: 150px;
                height: 150px;
            }
            
            .cyber-tab {
                padding: 0.6rem 1rem;
                font-size: 0.7rem;
            }
            
            .logo-text {
                font-size: 1.5rem;
            }
        }

        .app-section { display: none; height: 100%; opacity: 0; transition: opacity 0.3s ease; }
        .app-section.active { display: block; opacity: 1; }

        /* Inputs & Buttons */
        .cyber-input {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(0, 240, 255, 0.3);
            border-radius: 5px;
            padding: 0.8rem;
            color: var(--text);
            width: 100%;
            margin-bottom: 0.8rem;
        }
        .cyber-input:focus { border-color: var(--primary); outline: none; }
        .cyber-input::placeholder { color: var(--text-secondary); opacity: 0.7; }

        .cyber-button {
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            border: none;
            border-radius: 5px;
            padding: 0.8rem;
            color: white;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            text-transform: uppercase;
            transition: 0.3s;
        }
        .cyber-button:hover { transform: translateY(-2px); box-shadow: 0 0 15px rgba(0, 240, 255, 0.4); }
        .cyber-button:disabled { background: #333; color: #666; cursor: not-allowed; transform: none; box-shadow: none; }
        
        /* MAPS SECTION */
        .maps-section {
            position: relative;
            border-radius: 15px;
            overflow: hidden;
            background: var(--card-bg);
            border: 1px solid rgba(0, 240, 255, 0.3);
            height: 100%;
        }
        #map { height: 100%; width: 100%; z-index: 1; }
        .maps-controls {
            position: absolute; top: 20px; left: 20px; z-index: 999;
            background: rgba(17, 17, 40, 0.95); backdrop-filter: blur(10px);
            padding: 1.5rem; border-radius: 10px; border: 1px solid rgba(0, 240, 255, 0.3);
            width: 350px; max-height: calc(100% - 40px); overflow-y: auto;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        @media (max-width: 768px) {
            .maps-controls { top: auto; bottom: 0; left: 0; right: 0; width: 100%; max-height: 80vh; border-radius: 20px 20px 0 0; transform: translateY(0); }
            .maps-controls.hidden-panel { transform: translateY(100%); }
        }
        .mobile-map-toggle {
            display: none; position: absolute; bottom: 20px; right: 20px; z-index: 1000;
            background: var(--primary); color: var(--darker); border: none; border-radius: 50%;
            width: 50px; height: 50px; font-size: 1.2rem; box-shadow: 0 0 15px rgba(0, 240, 255, 0.5);
            cursor: pointer; align-items: center; justify-content: center;
        }
        @media (max-width: 768px) { .mobile-map-toggle { display: flex; } }
        .marker-categories { display: grid; grid-template-columns: repeat(3, 1fr); gap: 0.5rem; margin: 1rem 0; }
        .category-btn {
            background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 0.5rem; border-radius: 5px; color: var(--text-secondary);
            cursor: pointer; font-size: 0.7rem; display: flex; flex-direction: column; align-items: center; gap: 0.3rem;
            transition: all 0.2s ease;
        }
        .category-btn:hover { background: rgba(0, 240, 255, 0.05); }
        .category-btn.active { border-color: var(--primary); background: rgba(0, 240, 255, 0.2); color: var(--text); box-shadow: 0 0 5px rgba(0, 240, 255, 0.3); }
        .map-search-controls { display: flex; gap: 0.5rem; margin-bottom: 1rem; }
        .map-search-box { flex: 1; position: relative; }
        .map-search-box i { position: absolute; left: 10px; top: 50%; transform: translateY(-50%); color: var(--text-secondary); }
        .map-search-box input { padding-left: 35px; }
        .map-filter-btn {
            background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--text-secondary); padding: 0.5rem 1rem; border-radius: 5px; cursor: pointer;
            font-size: 0.8rem; transition: all 0.3s ease; display: flex; align-items: center; gap: 0.3rem;
        }
        .map-filter-btn.active { background: rgba(0, 240, 255, 0.2); border-color: var(--primary); color: var(--text); }
        .marker-list-container { margin-top: 1.5rem; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 1rem; }
        .marker-list { max-height: 300px; overflow-y: auto; margin-top: 0.5rem; }
        .marker-item {
            background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 5px; padding: 0.8rem; margin-bottom: 0.5rem; cursor: pointer; transition: all 0.3s ease;
        }
        .marker-item:hover { border-color: var(--primary); background: rgba(0, 240, 255, 0.1); }
        .marker-item h4 { color: var(--primary); margin-bottom: 0.3rem; font-size: 0.9rem; }
        .marker-item p { color: var(--text-secondary); font-size: 0.8rem; margin-bottom: 0.3rem; }
        .marker-item .marker-category {
            display: inline-block; background: rgba(0, 240, 255, 0.2); color: var(--primary);
            padding: 0.2rem 0.5rem; border-radius: 10px; font-size: 0.7rem;
        }

        /* QUEST BOARD */
        .quest-section {
            background: var(--card-bg); border-radius: 15px;
            border: 1px solid rgba(0, 240, 255, 0.3); height: 100%;
            display: flex; flex-direction: column; position: relative;
        }
        .quest-header { padding: 1.5rem; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .quest-list { flex: 1; overflow-y: auto; padding: 1rem; display: flex; flex-direction: column; gap: 1rem; }
        .quest-item {
            background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px; padding: 1.5rem; cursor: pointer; transition: 0.3s; position: relative;
        }
        .quest-item:hover { transform: translateY(-3px); border-color: var(--primary); }
        .quest-item h4 { color: var(--primary); margin-bottom: 0.5rem; }
        .quest-status { float: right; font-size: 0.7rem; padding: 2px 8px; border-radius: 10px; }
        .status-open { background: var(--success); color: black; }
        .status-taken { background: var(--warning); color: black; }
        .quest-controls { display: flex; gap: 1rem; margin-bottom: 1rem; flex-wrap: wrap; }
        .search-box { flex: 1; min-width: 200px; position: relative; }
        .search-box i { position: absolute; left: 10px; top: 50%; transform: translateY(-50%); color: var(--text-secondary); }
        .search-box input { padding-left: 35px; }
        .category-filter { display: flex; gap: 0.5rem; flex-wrap: wrap; }
        .filter-btn {
            background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--text-secondary); padding: 0.5rem 1rem; border-radius: 20px; cursor: pointer;
            font-size: 0.8rem; transition: all 0.3s ease;
        }
        .filter-btn.active { background: rgba(0, 240, 255, 0.2); border-color: var(--primary); color: var(--text); }
        .fab-add-quest {
            position: absolute; bottom: 2rem; right: 2rem; width: 60px; height: 60px;
            background: var(--primary); color: var(--darker); border-radius: 50%;
            display: flex; align-items: center; justify-content: center; font-size: 1.5rem;
            box-shadow: 0 0 20px rgba(0, 240, 255, 0.5); border: none; cursor: pointer; z-index: 10;
            transition: 0.3s;
        }
        .fab-add-quest:hover { transform: scale(1.1); }

        /* TOOLS SECTION (WHOIS) */
        .tools-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; padding: 2rem; }
        @media (max-width: 768px) { .tools-grid { padding: 1rem; } }
        .tool-card {
            background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px; padding: 1.5rem;
        }
        .tool-result {
            margin-top: 1rem; padding: 1rem;
            background: rgba(0,0,0,0.5); border: 1px solid rgba(255,255,255,0.1); border-radius: 5px;
            display: none; font-family: 'Consolas', monospace; font-size: 0.85rem;
            white-space: pre-wrap; color: #d0d0d0; line-height: 1.5;
        }
        
        /* AI CHAT SECTION */
        .ai-chat-section {
            background: var(--card-bg); border-radius: 15px;
            border: 1px solid rgba(0, 240, 255, 0.3); height: 100%;
            display: flex; flex-direction: column; position: relative;
        }
        .chat-header { padding: 1rem 1.5rem; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .chat-body { flex: 1; overflow-y: auto; padding: 1rem; display: flex; flex-direction: column; gap: 1rem; }
        .chat-input-area { 
            padding: 1rem 1.5rem; 
            border-top: 1px solid rgba(255,255,255,0.1); 
            display: flex; 
            flex-direction: column;
            gap: 0.5rem;
        }

        .message {
            max-width: 80%;
            padding: 0.7rem 1rem;
            border-radius: 15px;
            font-size: 0.9rem;
            word-wrap: break-word;
        }
        .user-message {
            background: var(--primary);
            color: var(--darker);
            align-self: flex-end;
            border-bottom-right-radius: 2px;
        }
        .ai-message {
            background: var(--dark);
            color: var(--text);
            border: 1px solid rgba(0, 240, 255, 0.3);
            align-self: flex-start;
            border-bottom-left-radius: 2px;
        }
        .message-model-tag {
            font-size: 0.7rem;
            color: var(--accent);
            margin-top: 5px;
            display: block;
        }
        .chat-controls { display: flex; gap: 0.5rem; align-items: flex-start; }
        .chat-input-wrapper { flex-grow: 1; position: relative; }
        .chat-input-wrapper textarea {
            min-height: 50px;
            resize: none;
            padding-right: 40px; 
            padding-top: 15px;
        }
        .chat-input-wrapper .send-btn {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--primary);
            font-size: 1.2rem;
            cursor: pointer;
            transition: 0.3s;
        }
        .chat-input-wrapper .send-btn:hover { color: var(--secondary); }
        .chat-input-wrapper .send-btn:disabled { color: #444; cursor: not-allowed; }

        .model-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .model-btn {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 8px 16px;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s ease;
        }

        .model-btn.active {
            background: rgba(0, 240, 255, 0.2);
            border-color: var(--primary);
            color: var(--text);
        }

        /* MODALS */
        .modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); backdrop-filter: blur(5px);
            z-index: 2000; justify-content: center; align-items: center;
        }
        .modal.active { display: flex; }
        .modal-content {
            background: var(--card-bg); border: 1px solid var(--primary);
            padding: 2rem; border-radius: 15px; width: 90%; max-width: 500px;
            max-height: 90vh; overflow-y: auto;
            position: relative;
        }
        .close-modal {
            position: absolute; top: 1rem; right: 1rem;
            background: none; border: none; color: white; font-size: 1.5rem; cursor: pointer;
            transition: 0.3s;
        }
        .close-modal:hover { color: var(--danger); transform: rotate(90deg); }

        /* Admin Section */
        .admin-section {
            display: none;
            padding: 2rem;
            background: var(--card-bg);
            border-radius: 15px;
            border: 1px solid rgba(0, 240, 255, 0.3);
            margin: 1rem;
        }
        .admin-section.active { display: block; }

        /* Mobile Adjustments */
        @media (max-width: 768px) {
            .header-content { flex-direction: column; gap: 1rem; }
            .nav-tabs { width: 100%; justify-content: center; }
            .cyber-tab { font-size: 0.8rem; padding: 0.6rem; }
            .quest-controls { flex-direction: column; }
            .map-search-controls { flex-direction: column; }
            .chat-input-area { padding: 0.5rem; }
            .model-selector { flex-direction: column; }
        }
    </style>
</head>
<body>

    <div id="loading-screen">
        <div class="loading-container">
            <div class="loading-background"></div>
            <div class="loading-logo">
                <span class="loading-logo-text">SIMPLE BISNIS</span>
            </div>
            <div class="loading-subtitle">
                Cyber Network Platform - Connecting Businesses in Digital Era
            </div>
            <div class="hologram-container">
                <div class="hologram">
                    <div class="hologram-inner">
                        <i class="fas fa-satellite-dish"></i>
                    </div>
                </div>
            </div>
            <div class="loading-progress-container">
                <div class="loading-progress-text">
                    <span>INITIALIZING SYSTEM</span>
                    <span id="loading-percentage">0%</span>
                </div>
                <div class="loading-progress">
                    <div class="loading-bar" id="loading-bar"></div>
                </div>
            </div>
            <div class="loading-dots">
                <div class="dot"></div>
                <div class="dot"></div>
                <div class="dot"></div>
            </div>
        </div>
    </div>

    <header class="cyber-header">
        <div class="header-content">
            <div class="logo">
                <i class="fas fa-satellite-dish logo-icon"></i>
                <div class="logo-text">SIMPLE BISNIS</div>
            </div>
            <div class="nav-tabs">
                <button class="cyber-tab active" onclick="switchTab('maps')">
                    <i class="fas fa-map-marked-alt"></i> MAPS
                </button>
                <button class="cyber-tab" onclick="switchTab('quests')">
                    <i class="fas fa-scroll"></i> QUEST BOARD
                </button>
                <button class="cyber-tab" onclick="switchTab('tools')">
                    <i class="fas fa-tools"></i> TOOLS
                </button>
                <button class="cyber-tab" onclick="switchTab('chat')">
                    <i class="fas fa-robot"></i> CHAT AI
                </button>
            </div>
        </div>
    </header>

    <div class="main-container">
        
        <div id="maps" class="app-section active">
            <div class="maps-section">
                <button class="mobile-map-toggle" onclick="toggleMapPanel()">
                    <i class="fas fa-layer-group"></i>
                </button>

                <div class="maps-controls" id="mapPanel">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h3 style="color: var(--primary);"><i class="fas fa-map-pin"></i> KONTROL MAP</h3>
                        <button onclick="toggleMapPanel()" style="background:none; border:none; color:white; cursor:pointer;" title="Minimize">
                            <i class="fas fa-chevron-down"></i>
                        </button>
                    </div>

                    <div style="background: rgba(0,240,255,0.1); padding: 0.5rem; border-radius: 5px; margin-bottom: 1rem; font-size: 0.9rem;">
                        <i class="fas fa-info-circle"></i> Klik pada peta untuk memilih lokasi marker.
                    </div>

                    <div class="map-search-controls">
                        <div class="map-search-box">
                            <i class="fas fa-search"></i>
                            <input type="text" id="mapSearch" class="cyber-input" placeholder="Cari lokasi...">
                        </div>
                        <button class="map-filter-btn" onclick="toggleMapFilter()">
                            <i class="fas fa-filter"></i> Filter
                        </button>
                    </div>

                    <div id="mapFilterOptions" style="display: none; margin-bottom: 1rem;">
                        <div style="color: var(--text-secondary); font-size: 0.8rem; margin-bottom: 0.5rem;">Filter Kategori:</div>
                        <div class="category-filter">
                            <button class="filter-btn active" onclick="filterMapMarkers(event, 'all')">Semua</button>
                            <button class="filter-btn" onclick="filterMapMarkers(event, 'traffic')">Macet</button>
                            <button class="filter-btn" onclick="filterMapMarkers(event, 'accident')">Kecelakaan</button>
                            <button class="filter-btn" onclick="filterMapMarkers(event, 'shop')">Toko</button>
                            <button class="filter-btn" onclick="filterMapMarkers(event, 'service')">Jasa</button>
                            <button class="filter-btn" onclick="filterMapMarkers(event, 'event')">Event</button>
                        </div>
                    </div>

                    <input type="text" id="markerTitle" class="cyber-input" placeholder="Judul (Cth: Macet Total)">
                    <textarea id="markerDesc" class="cyber-input" rows="2" placeholder="Deskripsi Singkat..."></textarea>

                    <label style="color: var(--text-secondary); font-size: 0.8rem;">Kategori Marker:</label>
                    <div class="marker-categories" id="categoryGrid">
                        <div class="category-btn active" onclick="selectCategory(this, 'traffic')">
                            <i class="fas fa-traffic-light"></i> Macet
                        </div>
                        <div class="category-btn" onclick="selectCategory(this, 'accident')">
                            <i class="fas fa-car-crash"></i> Kecelakaan
                        </div>
                        <div class="category-btn" onclick="selectCategory(this, 'shop')">
                            <i class="fas fa-store"></i> Toko
                        </div>
                        <div class="category-btn" onclick="selectCategory(this, 'service')">
                            <i class="fas fa-tools"></i> Jasa
                        </div>
                        <div class="category-btn" onclick="selectCategory(this, 'event')">
                            <i class="fas fa-calendar"></i> Event
                        </div>
                        <div class="category-btn" onclick="selectCategory(this, 'other')">
                            <i class="fas fa-map-marker-alt"></i> Lainnya
                        </div>
                    </div>

                    <label style="color: var(--text-secondary); font-size: 0.8rem;">Buat Kategori Custom:</label>
                    <div class="custom-maker-group">
                        <input type="text" id="customCatName" class="cyber-input" style="margin-bottom:0;" placeholder="Nama Kategori Baru...">
                        <button class="cyber-button" onclick="saveCustomCategory()" style="margin-top: 0.5rem;">
                            SIMPAN KATEGORI
                        </button>
                    </div>
                    <div id="customCatList" style="display: flex; flex-wrap: wrap; gap: 0.5rem; margin-top: 0.5rem;"></div>

                    <div style="margin-top: 1.5rem;">
                        <button class="cyber-button" onclick="addMarker()" id="btnAddMarker" disabled>
                            <i class="fas fa-plus-circle"></i> TAMBAH MARKER
                        </button>
                    </div>

                    <div class="marker-list-container">
                        <h4 style="color: var(--primary); margin-bottom: 0.5rem;">
                            <i class="fas fa-list"></i> DAFTAR MARKER
                        </h4>
                        <div class="marker-list" id="markerList">
                            </div>
                    </div>
                </div>
                <div id="map"></div>
            </div>
        </div>

        <div id="quests" class="app-section">
            <div class="quest-section">
                <div class="quest-header">
                    <h2 style="color: var(--primary);"><i class="fas fa-scroll"></i> PAPAN QUEST</h2>
                    <p style="color: var(--text-secondary);">Ambil pekerjaan atau tawarkan jasa di sini.</p>
                    
                    <div class="quest-controls">
                        <div class="search-box">
                            <i class="fas fa-search"></i>
                            <input type="text" id="questSearch" class="cyber-input" placeholder="Cari quest...">
                        </div>
                        <div class="category-filter">
                            <button class="filter-btn active" onclick="filterQuests(event, 'all')">Semua</button>
                            <button class="filter-btn" onclick="filterQuests(event, 'design')">Desain</button>
                            <button class="filter-btn" onclick="filterQuests(event, 'programming')">Programming</button>
                            <button class="filter-btn" onclick="filterQuests(event, 'marketing')">Marketing</button>
                            <button class="filter-btn" onclick="filterQuests(event, 'writing')">Writing</button>
                            <button class="filter-btn" onclick="filterQuests(event, 'other')">Lainnya</button>
                        </div>
                    </div>
                </div>
                
                <div class="quest-list" id="questListContainer">
                    </div>

                <button class="fab-add-quest" onclick="openModal('modalPostQuest')">
                    <i class="fas fa-plus"></i>
                </button>
            </div>
        </div>

        <div id="tools" class="app-section">
            <h2 style="color: var(--primary); margin-bottom: 1rem; padding: 0 1rem;"><i class="fas fa-terminal"></i> CYBER TOOLS</h2>
            <div class="tools-grid">
                
                <div class="tool-card">
                    <h3 style="color: var(--warning);"><i class="fas fa-globe"></i> WHOIS & DOMAIN INFO</h3>
                    <p style="font-size: 0.8rem; color: #888; margin-bottom: 1rem;">
                        Cek status domain terdaftar atau tidak (Menggunakan Google DNS over HTTPS).
                    </p>
                    <input type="text" id="domainInput" class="cyber-input" placeholder="contoh: google.com">
                    <button class="cyber-button" onclick="checkWhois()">CEK DOMAIN</button>
                    <div id="whoisResult" class="tool-result"></div>
                </div>

            </div>
        </div>
        
        <div id="chat" class="app-section">
            <div class="ai-chat-section">
                <div class="chat-header">
                    <h2 style="color: var(--primary);"><i class="fas fa-robot"></i> CHAT AI</h2>
                    <p style="color: var(--text-secondary); font-size: 0.8rem;">DeX 75 AI & Pollination AI Powered</p>
                    
                    <div class="model-selector">
                        <button class="model-btn active" onclick="selectModel('dex75')">
                            <i class="fas fa-brain"></i> DeX 75 AI
                        </button>
                        <button class="model-btn" onclick="selectModel('pollination')">
                            <i class="fas fa-robot"></i> Pollination AI
                        </button>
                    </div>
                </div>
                
                <div class="chat-body" id="chatBody">
                    <div class="ai-message message">
                        Halo! Saya adalah AI asisten yang siap membantu Anda. Silakan pilih model AI dan mulai chat.
                        <span class="message-model-tag">System</span>
                    </div>
                </div>

                <div class="chat-input-area">
                    <div class="chat-controls">
                        <div class="chat-input-wrapper">
                            <textarea id="chatInput" class="cyber-input" rows="1" placeholder="Tulis pesan..." style="margin-bottom: 0;"></textarea>
                            <button class="send-btn" onclick="sendMessage()" id="chatSendButton">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="admin" class="admin-section">
            <h2 style="color: var(--primary); margin-bottom: 1rem;"><i class="fas fa-user-shield"></i> ADMIN PANEL</h2>
            <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">Panel ini hanya dapat diakses melalui URL /admin</p>
            
            <div class="tools-grid">
                <div class="tool-card">
                    <h3 style="color: var(--accent);"><i class="fas fa-database"></i> Data Management</h3>
                    <p style="font-size: 0.8rem; color: #888; margin-bottom: 1rem;">
                        Kelola data quests, users, dan markers.
                    </p>
                    <button class="cyber-button" onclick="exportData()">EXPORT DATA</button>
                    <button class="cyber-button" style="background: var(--danger); margin-top: 0.5rem;" onclick="clearAllData()">CLEAR ALL DATA</button>
                </div>

                <div class="tool-card">
                    <h3 style="color: var(--warning);"><i class="fas fa-chart-bar"></i> Analytics</h3>
                    <p style="font-size: 0.8rem; color: #888; margin-bottom: 1rem;">
                        Lihat statistik penggunaan aplikasi.
                    </p>
                    <button class="cyber-button" onclick="showAnalytics()">VIEW ANALYTICS</button>
                </div>
            </div>
        </div>
    </div>

    <div id="modalPostQuest" class="modal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal('modalPostQuest')">&times;</button>
            <h3 style="color: var(--primary); margin-bottom: 1rem;">BUAT QUEST BARU</h3>
            
            <input type="text" id="qUser" class="cyber-input" placeholder="Nama Anda / Username">
            <input type="text" id="qTitle" class="cyber-input" placeholder="Judul Quest (Cth: Butuh Desain Logo)">
            <textarea id="qDesc" class="cyber-input" rows="4" placeholder="Detail pekerjaan..."></textarea>
            <input type="text" id="qContact" class="cyber-input" placeholder="Nomor WA (628xxx) / Telegram">
            
            <label style="color: var(--text-secondary); font-size: 0.8rem; margin-top: 1rem;">Kategori Quest:</label>
            <select id="qCategory" class="cyber-input">
                <option value="design">Desain</option>
                <option value="programming">Programming</option>
                <option value="marketing">Marketing</option>
                <option value="writing">Writing</option>
                <option value="other">Lainnya</option>
            </select>
            
            <button class="cyber-button" onclick="submitQuest()">POSTING QUEST</button>
        </div>
    </div>

    <div id="modalQuestDetail" class="modal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal('modalQuestDetail')">&times;</button>
            <h3 id="dTitle" style="color: var(--primary); margin-bottom: 0.5rem;">Judul Quest</h3>
            <div style="font-size: 0.8rem; color: var(--accent); margin-bottom: 1rem;">
                Posted by: <span id="dUser">User</span> | 
                Kategori: <span id="dCategory">-</span>
            </div>
            
            <div style="background: rgba(255,255,255,0.05); padding: 1rem; border-radius: 5px; margin-bottom: 1.5rem;">
                <p id="dDesc">Deskripsi...</p>
            </div>

            <div style="display: grid; gap: 1rem;">
                <button class="cyber-button" style="background: var(--success); color: #000;" id="btnWA">
                    <i class="fab fa-whatsapp"></i> HUBUNGI WA
                </button>
                <button class="cyber-button" onclick="takeOrder()" id="btnTake">
                    <i class="fas fa-check-circle"></i> AMBIL ORDER
                </button>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // --- KONFIGURASI API ---
        const API_CONFIG = {
            dex75: "https://api.ryzumi.vip/api/ai/deepseek",
            pollination: "https://api.ryzumi.vip/api/ai/v2/chatgpt"
        };

        // --- GLOBAL VARIABLES ---
        let map, currentMarker = null;
        let selectedCategory = 'traffic';
        let currentQuestId = null;
        let currentQuestFilter = 'all';
        let currentQuestSearch = '';
        let markers = []; 
        let markerLayerGroup = L.layerGroup(); 
        let currentMapFilter = 'all';
        let selectedModel = 'dex75';

        // Mock Data Storage
        let quests = [
            { 
                id: 1, 
                user: 'Admin', 
                title: 'Butuh Desain Logo Simple Bisnis', 
                desc: 'Membutuhkan desain logo untuk website Simple Bisnis dengan tema cyber dan modern. Warna utama biru dan pink.', 
                contact: '62812345678', 
                category: 'design',
                status: 'open' 
            },
            { 
                id: 2, 
                user: 'BudiDev', 
                title: 'Buat Website Toko Online', 
                desc: 'Membutuhkan developer untuk membuat website toko online dengan fitur cart, payment gateway, dan admin panel.', 
                contact: '62887654321', 
                category: 'programming',
                status: 'open' 
            },
            { 
                id: 3, 
                user: 'MarketingPro', 
                title: 'Konsultan Digital Marketing', 
                desc: 'Menawarkan jasa konsultasi digital marketing untuk bisnis UMKM. Fokus pada SEO dan social media marketing.', 
                contact: '62811223344', 
                category: 'marketing',
                status: 'taken' 
            }
        ];

        // --- LOADING SCREEN ---
        function simulateLoading() {
            const loadingBar = document.getElementById('loading-bar');
            const loadingPercentage = document.getElementById('loading-percentage');
            const loadingScreen = document.getElementById('loading-screen');
            let progress = 0;
            
            const interval = setInterval(() => {
                progress += Math.random() * 15;
                if (progress > 100) progress = 100;
                loadingBar.style.width = `${progress}%`;
                loadingPercentage.textContent = `${Math.floor(progress)}%`;
                
                if (progress >= 100) {
                    clearInterval(interval);
                    setTimeout(() => {
                        loadingScreen.style.opacity = '0';
                        setTimeout(() => {
                            loadingScreen.style.display = 'none';
                        }, 500);
                    }, 500);
                }
            }, 200);
        }

// --- ADMIN ACCESS CONTROL ---
function checkAdminAccess() {
    // Multiple access methods
    const isAdminPath = window.location.pathname.includes('/admin');
    const urlParams = new URLSearchParams(window.location.search);
    const isAdminParam = urlParams.get('admin') === 'true';
    const isAdminHash = window.location.hash === '#admin';
    
    if (isAdminPath || isAdminParam || isAdminHash) {
        // Show admin section and hide others
        document.querySelectorAll('.app-section').forEach(el => {
            if (el.id !== 'admin') {
                el.style.display = 'none';
            } else {
                el.style.display = 'block';
                el.classList.add('active');
            }
        });
        
        // Replace navigation tabs with only Admin tab
        const navTabs = document.querySelector('.nav-tabs');
        navTabs.innerHTML = '';
        
        const adminTab = document.createElement('button');
        adminTab.className = 'cyber-tab active';
        adminTab.innerHTML = '<i class="fas fa-user-shield"></i> ADMIN';
        adminTab.onclick = () => switchTab('admin');
        navTabs.appendChild(adminTab);
        
        // Update browser title
        document.title = 'SIMPLE BISNIS - Admin Panel';
        
        // Show admin access method in console
        console.log('Admin access via:', {
            path: isAdminPath ? '/admin' : null,
            param: isAdminParam ? '?admin=true' : null,
            hash: isAdminHash ? '#admin' : null
        });
    }
}

// --- INITIALIZATION ---
window.onload = function() {
    simulateLoading();
    initMap();
    renderQuests();
    checkAdminAccess();
    
    // Event Listeners
    document.getElementById('questSearch').addEventListener('input', function() {
        currentQuestSearch = this.value.toLowerCase();
        renderQuests();
    });
    
    document.getElementById('mapSearch').addEventListener('input', function() {
        searchMapLocations(this.value);
    });
    
    document.getElementById('chatInput').addEventListener('keypress', function(e) {
        if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            sendMessage();
        }
    });
    
    // Auto-resize textarea
    document.getElementById('chatInput').addEventListener('input', function() {
        this.style.height = 'auto';
        this.style.height = (this.scrollHeight) + 'px';
    });
};

function switchTab(tabId) {
    // Special handling for admin tab
    if (tabId === 'admin') {
        document.querySelectorAll('.app-section').forEach(el => {
            if (el.id !== 'admin') {
                el.style.display = 'none';
            } else {
                el.style.display = 'block';
                el.classList.add('active');
            }
        });
        
        document.querySelectorAll('.cyber-tab').forEach(el => el.classList.remove('active'));
        document.querySelector('.cyber-tab').classList.add('active'); // Admin tab is the only one
        return;
    }
    
    // Normal tab switching for non-admin
    document.querySelectorAll('.app-section').forEach(el => {
        el.style.display = 'block';
        el.classList.remove('active');
    });
    document.querySelectorAll('.cyber-tab').forEach(el => el.classList.remove('active'));
    
    document.getElementById(tabId).classList.add('active');
    
    const tabs = document.querySelectorAll('.cyber-tab');
    tabs.forEach(tab => {
        const tabText = tab.textContent.trim().split(' ').pop().toLowerCase();
        if (tabText === tabId || (tabId === 'chat' && tabText === 'ai')) {
            tab.classList.add('active');
        }
    });
    
    if (tabId === 'maps' && map) {
        setTimeout(() => map.invalidateSize(), 100);
    }
}

// --- MODEL SELECTION ---
function selectModel(model) {
    selectedModel = model;
    document.querySelectorAll('.model-btn').forEach(btn => btn.classList.remove('active'));
    event.target.classList.add('active');
}
        // --- MAP LOGIC ---
        function initMap() {
            // Koordinat Jakarta Pusat sebagai default
            map = L.map('map').setView([-6.200000, 106.816666], 13);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; OpenStreetMap'
            }).addTo(map);
            markerLayerGroup.addTo(map);

            map.on('click', function(e) {
                if(currentMarker) map.removeLayer(currentMarker);
                currentMarker = L.marker(e.latlng).addTo(map);
                document.getElementById('btnAddMarker').disabled = false;
                
                const panel = document.getElementById('mapPanel');
                if(window.innerWidth <= 768 && panel.classList.contains('hidden-panel')) {
                    toggleMapPanel();
                }
            });
            
            addSampleMarkers();
        }

        function addSampleMarkers() {
            const sampleMarkers = [
                { lat: -6.2000, lng: 106.8166, title: 'Macet di Bundaran HI', desc: 'Kemacetan parah akibat kecelakaan', category: 'traffic' },
                { lat: -6.1900, lng: 106.8200, title: 'Toko Elektronik', desc: 'Jual beli sparepart murah', category: 'shop' }
            ];
            sampleMarkers.forEach(addMarkerToMap);
            renderMarkerList();
        }

        function addMarkerToMap(markerData) {
            const marker = L.marker([markerData.lat, markerData.lng]).addTo(markerLayerGroup);
            marker.bindPopup(`<b>${markerData.title}</b><br>${markerData.desc}<br><i>Category: ${markerData.category}</i>`);
            
            markers.push({
                marker: marker,
                title: markerData.title,
                desc: markerData.desc,
                category: markerData.category,
                lat: markerData.lat,
                lng: markerData.lng
            });
        }

        function renderMarkerList() {
            const container = document.getElementById('markerList');
            container.innerHTML = '';
            
            const searchTerm = document.getElementById('mapSearch').value.toLowerCase();
            const filteredMarkers = markers.filter(m => 
                (currentMapFilter === 'all' || m.category === currentMapFilter) &&
                (m.title.toLowerCase().includes(searchTerm) || m.desc.toLowerCase().includes(searchTerm))
            );
            
            if (filteredMarkers.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 1rem; color: var(--text-secondary);">Tidak ada marker yang cocok.</div>';
                return;
            }
            
            filteredMarkers.forEach((markerData) => {
                const item = document.createElement('div');
                item.className = 'marker-item';
                item.onclick = () => {
                    map.setView([markerData.lat, markerData.lng], 15);
                    markerData.marker.openPopup();
                };
                item.innerHTML = `<h4>${markerData.title}</h4><p>${markerData.desc}</p><span class="marker-category">${markerData.category}</span>`;
                container.appendChild(item);
                
                // Tambahkan/Tampilkan marker di peta sesuai filter
                if (!markerLayerGroup.hasLayer(markerData.marker)) {
                    markerLayerGroup.addLayer(markerData.marker);
                }
            });
            
            // Sembunyikan marker yang tidak sesuai filter/search
            markers.forEach(m => {
                if (!filteredMarkers.includes(m) && markerLayerGroup.hasLayer(m.marker)) {
                    markerLayerGroup.removeLayer(m.marker);
                }
            });
        }

        function toggleMapPanel() {
            document.getElementById('mapPanel').classList.toggle('hidden-panel');
        }

        function toggleMapFilter() {
            const filterOptions = document.getElementById('mapFilterOptions');
            const filterBtn = document.querySelector('.map-filter-btn');
            const isHidden = filterOptions.style.display === 'none';
            filterOptions.style.display = isHidden ? 'block' : 'none';
            filterBtn.classList.toggle('active', isHidden);
        }

        function selectCategory(elem, cat) {
            document.querySelectorAll('.marker-categories .category-btn').forEach(btn => btn.classList.remove('active'));
            elem.classList.add('active');
            selectedCategory = cat;
        }

        function saveCustomCategory() {
            const name = document.getElementById('customCatName').value.trim();
            if(!name) return alert("Nama kategori tidak boleh kosong!");
            const catId = 'custom-' + name.toLowerCase().replace(/\s/g, '-');
            
            // Cek duplikasi
            if (document.querySelector(`.category-btn[onclick*="${catId}"]`)) {
                 return alert(`Kategori "${name}" sudah ada!`);
            }
            
            const container = document.getElementById('categoryGrid');
            const newBtn = document.createElement('div');
            newBtn.className = 'category-btn';
            newBtn.innerHTML = `<i class="fas fa-star"></i> ${name}`;
            newBtn.onclick = function() { selectCategory(this, catId) };
            container.appendChild(newBtn);
            
            document.getElementById('customCatName').value = '';
            alert(`Kategori "${name}" berhasil disimpan!`);
            selectCategory(newBtn, catId); // Langsung pilih
        }

        function addMarker() {
            const title = document.getElementById('markerTitle').value;
            const desc = document.getElementById('markerDesc').value;
            if(!title) return alert("Judul marker harus diisi!");
            if(!currentMarker) return alert("Klik peta lokasi dulu!");
            
            const latlng = currentMarker.getLatLng();
            
            // Hapus temporary marker
            map.removeLayer(currentMarker);
            currentMarker = null;
            
            addMarkerToMap({
                lat: latlng.lat,
                lng: latlng.lng,
                title: title,
                desc: desc,
                category: selectedCategory
            });
            
            renderMarkerList();
            document.getElementById('markerTitle').value = '';
            document.getElementById('markerDesc').value = '';
            document.getElementById('btnAddMarker').disabled = true;
            alert("Marker berhasil ditambahkan!");
        }

        function searchMapLocations(query) {
             // Search hanya mempengaruhi list, filter tetap aktif
            renderMarkerList(); 
        }

        function filterMapMarkers(event, category) {
            currentMapFilter = category;
            document.querySelectorAll('#mapFilterOptions .filter-btn').forEach(btn => btn.classList.remove('active'));
            event.currentTarget.classList.add('active');
            renderMarkerList();
        }

        // --- QUEST BOARD LOGIC ---
        function filterQuests(event, category) {
            currentQuestFilter = category;
            document.querySelectorAll('.quest-controls .filter-btn').forEach(btn => btn.classList.remove('active'));
            event.currentTarget.classList.add('active');
            renderQuests();
        }

        function renderQuests() {
            const container = document.getElementById('questListContainer');
            container.innerHTML = '';
            
            let filteredQuests = quests;
            
            // 1. Filter Kategori
            if (currentQuestFilter !== 'all') {
                filteredQuests = filteredQuests.filter(q => q.category === currentQuestFilter);
            }
            
            // 2. Filter Search
            if (currentQuestSearch) {
                filteredQuests = filteredQuests.filter(q => 
                    q.title.toLowerCase().includes(currentQuestSearch) || 
                    q.desc.toLowerCase().includes(currentQuestSearch) ||
                    q.user.toLowerCase().includes(currentQuestSearch)
                );
            }
            
            if (filteredQuests.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 2rem; color: var(--text-secondary);">Tidak ada quest yang cocok.</div>';
                return;
            }
            
            filteredQuests.forEach(q => {
                const item = document.createElement('div');
                item.className = 'quest-item';
                const statusClass = q.status === 'open' ? 'status-open' : 'status-taken';
                const statusText = q.status === 'open' ? 'OPEN' : 'TAKEN';
                item.innerHTML = `
                    <span class="quest-status ${statusClass}">${statusText}</span>
                    <h4>${q.title}</h4>
                    <p style="font-size: 0.9rem; color: #aaa;">${q.desc.substring(0, 80)}${q.desc.length > 80 ? '...' : ''}</p>
                    <div style="margin-top:0.5rem; display: flex; justify-content: space-between; font-size:0.8rem;">
                        <span style="color: var(--primary);"><i class="fas fa-user"></i> ${q.user}</span>
                        <span style="color: var(--text-secondary);"><i class="fas fa-tag"></i> ${q.category.toUpperCase()}</span>
                    </div>`;
                item.onclick = () => openQuestDetail(q);
                container.appendChild(item);
            });
        }

        function openModal(id) { document.getElementById(id).classList.add('active'); }
        function closeModal(id) { document.getElementById(id).classList.remove('active'); }

        function submitQuest() {
            const user = document.getElementById('qUser').value.trim();
            const title = document.getElementById('qTitle').value.trim();
            const desc = document.getElementById('qDesc').value.trim();
            const contact = document.getElementById('qContact').value.trim();
            const category = document.getElementById('qCategory').value;
            
            if(!user || !title || !contact || !desc) return alert("Mohon lengkapi semua data!");
            
            quests.push({ 
                id: Date.now(), 
                user, 
                title, 
                desc, 
                contact, 
                category, 
                status: 'open' 
            });
            
            renderQuests();
            closeModal('modalPostQuest');
            // Reset form
            document.getElementById('qUser').value = '';
            document.getElementById('qTitle').value = '';
            document.getElementById('qDesc').value = '';
            document.getElementById('qContact').value = '';
            alert("Quest berhasil diposting!");
        }

        function openQuestDetail(quest) {
            currentQuestId = quest.id;
            document.getElementById('dTitle').innerText = quest.title;
            document.getElementById('dUser').innerText = quest.user;
            document.getElementById('dDesc').innerText = quest.desc;
            document.getElementById('dCategory').innerText = quest.category.toUpperCase();
            
            // Link WA: Hapus non-digit dan pastikan format 62...
            const cleanContact = quest.contact.replace(/\D/g, '');
            document.getElementById('btnWA').onclick = function() { window.open(`https://wa.me/${cleanContact}`, '_blank'); };
            
            const btnTake = document.getElementById('btnTake');
            if(quest.status === 'taken') {
                btnTake.disabled = true; btnTake.innerHTML = "<i class='fas fa-lock'></i> SUDAH DIAMBIL";
            } else {
                btnTake.disabled = false; btnTake.innerHTML = '<i class="fas fa-check-circle"></i> AMBIL ORDER';
            }
            openModal('modalQuestDetail');
        }

        function takeOrder() {
            const q = quests.find(x => x.id === currentQuestId);
            if(q) { 
                q.status = 'taken'; 
                renderQuests(); 
                closeModal('modalQuestDetail'); 
                alert(`Order "${q.title}" berhasil diambil! Silakan hubungi ${q.user}.`); 
            }
        }
        
        // --- ADMIN / DATA LOGIC ---
        function exportData() {
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify({ quests, markers: markers.map(m => ({ title: m.title, desc: m.desc, category: m.category, lat: m.lat, lng: m.lng })), exportedAt: new Date().toISOString() }));
            const anchor = document.createElement('a');
            anchor.setAttribute("href", dataStr);
            anchor.setAttribute("download", "simplebisnis_data.json");
            document.body.appendChild(anchor);
            anchor.click();
            anchor.remove();
        }

        function clearAllData() {
            if(confirm("PERINGATAN! Anda yakin ingin menghapus SEMUA data quests dan markers? Aksi ini TIDAK dapat dibatalkan!")) { 
                quests = []; 
                markers = []; 
                markerLayerGroup.clearLayers(); 
                renderQuests(); 
                renderMarkerList(); 
                alert("Semua Data Dihapus!"); 
            }
        }

        function showAnalytics() {
            alert(`Total Quests: ${quests.length}\nTotal Markers: ${markers.length}\nQuests Open: ${quests.filter(q => q.status === 'open').length}\nQuests Taken: ${quests.filter(q => q.status === 'taken').length}`);
        }
        
        // --- WHOIS CHECKER LOGIC ---
        async function checkWhois() {
            const domainInput = document.getElementById('domainInput');
            const resDiv = document.getElementById('whoisResult');
            
            let domainToCheck = domainInput.value.trim().toLowerCase();
            domainToCheck = domainToCheck.replace(/^https?:\/\//, '').split('/')[0];
            
            const parts = domainToCheck.split('.');
            if (parts.length > 2) {
                domainToCheck = parts.slice(-2).join('.'); 
            }
            
            let domain = domainToCheck;

            resDiv.style.display = 'block';
            resDiv.innerHTML = `
                <div style="text-align:center;">
                    <i class="fas fa-satellite-dish fa-spin" style="color:var(--primary); font-size:2rem; margin-bottom:10px;"></i><br>
                    <span style="animation: pulse 1.5s infinite;">MENGIRIM QUERY DNS...</span>
                </div>`;

            if (!domain.includes('.') || domain.length < 4) {
                resDiv.innerHTML = "<span style='color:var(--danger)'>Format domain salah (cth: google.com)</span>";
                return;
            }

            try {
                // Menggunakan API Google DNS over HTTPS (DoH)
                const dnsUrl = `https://dns.google/resolve?name=${domain}`;
                const response = await fetch(dnsUrl);
                
                if (!response.ok) throw new Error("Gagal menghubungi Google DNS");

                const data = await response.json();

                if (data.Status === 0 && data.Answer && data.Answer.length > 0) {
                    renderDohRegistered(domain, resDiv, data.Answer);
                } else if (data.Status === 3) {
                    renderAvailable(domain, resDiv);
                } else {
                    renderError(domain, resDiv, "Respon DNS tidak valid.");
                }

            } catch (error) {
                console.error("DNS/Network Error:", error);
                renderError(domain, resDiv, `Gagal Melakukan Cek DNS: ${error.message}`);
            }
        }

        function renderAvailable(domain, container) {
            container.innerHTML = `
                <div style="text-align:center; padding:1rem; border: 1px dashed var(--success); border-radius:10px;">
                    <i class="fas fa-check-circle" style="font-size:3rem; color:var(--success); margin-bottom:1rem;"></i><br>
                    <span style="color:var(--success); font-weight:bold; font-size:1.2rem;">DOMAIN KOSONG!</span><br>
                    <p style="color:#ccc; font-size:0.9rem; margin:0.5rem 0;">
                        Domain <b>${domain}</b> belum terdaftar. Kamu bisa memilikinya.
                    </p>
                    <a href="https://www.niagahoster.co.id/domain-murah?domain=${domain}" target="_blank" 
                       style="background:var(--success); color:black; padding:5px 15px; border-radius:5px; text-decoration:none; font-weight:bold; font-size:0.8rem; display:inline-block; margin-top:10px;">
                       AMANKAN SEKARANG
                    </a>
                </div>
            `;
        }

        function renderDohRegistered(domain, container, answers) {
            const ipAddress = answers.find(a => a.type === 1)?.data || 'Tidak ada IP (Mungkin CNAME)';
            const ttl = answers.length > 0 ? answers[0].TTL : '-';

            let html = `
                <div style="border-left: 3px solid var(--danger); padding-left:10px; margin-bottom:1rem;">
                    <div style="display: flex; align-items: center; margin-bottom: 5px;">
                        <span style="color:var(--danger); font-weight:bold; font-size:1.1rem; margin-right: 8px;">
                            <i class="fas fa-lock"></i> DOMAIN TERDAFTAR
                        </span>
                    </div>
                    <p style="color:#aaa; font-size:0.8rem;">Data ini diambil dari server DNS Google.</p>
                </div>
                
                <table style="width:100%; font-size:0.85rem; border-collapse: separate; border-spacing: 0 5px;">
                    <tr>
                        <td style="color:var(--primary); width:35%;">Domain:</td>
                        <td style="color:white; font-family:monospace;">${domain}</td>
                    </tr>
                    <tr>
                        <td style="color:var(--primary);">Status:</td>
                        <td style="color:var(--danger); font-weight:bold;">AKTIF (DNS DITEMUKAN)</td>
                    </tr>
                    <tr>
                        <td style="color:var(--primary);">IP Address:</td>
                        <td style="color:var(--accent);">${ipAddress}</td>
                    </tr>
                    <tr>
                        <td style="color:var(--primary);">TTL (detik):</td>
                        <td style="color:#aaa;">${ttl}</td>
                    </tr>
                </table>

                <div style="margin-top:20px; padding: 10px; border: 1px dashed rgba(255,255,255,0.2); border-radius: 5px;">
                    <span style="color:var(--text-secondary); font-size:0.9rem; display: block; text-align: center; margin-bottom: 5px;">
                         **Info Lengkap (Registrar/Expired)** memerlukan Cek Manual:
                    </span>
                    <a href="https://who.is/whois/${domain}" target="_blank" class="cyber-button" style="text-decoration:none; display:block; margin-top:5px;">
                        CEK MANUAL (WHO.IS)
                    </a>
                </div>
            `;
            container.innerHTML = html;
        }
        
        function renderError(domain, container, message) {
            container.innerHTML = `
                <div style="color:var(--warning); text-align:center; padding:1rem;">
                    <i class="fas fa-exclamation-triangle"></i><br>
                    <b>${message}</b><br>
                    <span style="font-size:0.8rem">Periksa koneksi internet/format domain.</span>
                    <br><br>
                    <a href="https://who.is/whois/${domain}" target="_blank" class="cyber-button" style="text-decoration:none; display:block;">
                        CEK MANUAL (WHO.IS)
                    </a>
                </div>`;
        }
        
        // --- CHAT AI LOGIC - DeX 75 & Pollination AI ---
        
        async function sendMessage() {
            const chatInput = document.getElementById('chatInput');
            const chatBody = document.getElementById('chatBody');
            const sendBtn = document.getElementById('chatSendButton');

            const text = chatInput.value.trim();
            if (!text) return alert("Pesan tidak boleh kosong!");

            // 1. Tambahkan pesan user ke chat
            appendMessage(text, 'user', selectedModel);

            // 2. Clear input
            chatInput.value = '';
            sendBtn.disabled = true;
            chatInput.style.height = 'auto';

            try {
                // 3. Persiapan request
                const loadingMessage = appendMessage('<i class="fas fa-spinner fa-spin"></i> Menunggu respons...', 'ai', selectedModel);
                
                let apiUrl;
                const encodedMessage = encodeURIComponent(text);
                
                if (selectedModel === 'dex75') {
                    apiUrl = `https://api.ryzumi.vip/api/ai/deepseek?text=${encodedMessage}`;
                } else if (selectedModel === 'pollination') {
                    apiUrl = `https://api.ryzumi.vip/api/ai/v2/chatgpt?text=${encodedMessage}`;
                }

                console.log(`Mengirim request ke: ${apiUrl}`);

                // 4. Kirim request ke API - menggunakan GET
                const response = await fetch(apiUrl, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });

                console.log(`Response status: ${response.status}`);
                
                // 5. Proses Respon
                chatBody.removeChild(loadingMessage); 

                if (response.ok) {
                    const data = await response.json();
                    console.log('Response data:', data);
                    
                    let resultText = "";
                    
                    // Handle different response structures
                    if (selectedModel === 'dex75') {
                        resultText = data.data?.result || data.answer || data.data?.answer || "Tidak ada respons dari DeX 75 AI.";
                    } else if (selectedModel === 'pollination') {
                        // Coba berbagai kemungkinan struktur response Pollination AI
                        resultText = data.data?.result || 
                                   data.data?.answer || 
                                   data.answer || 
                                   data.result ||
                                   data.data?.text ||
                                   data.text ||
                                   data.data?.message ||
                                   data.message ||
                                   "Tidak ada respons dari Pollination AI.";
                    }
                    
                    // Jika masih kosong, tampilkan raw data untuk debugging
                    if (!resultText || resultText === "Tidak ada respons dari Pollination AI.") {
                        console.log('Raw Pollination AI response:', data);
                        resultText = "Pollination AI merespons dengan struktur yang tidak dikenali. Silakan coba lagi.";
                    }
                    
                    // Decode HTML entities
                    const tempDiv = document.createElement('div');
                    tempDiv.innerHTML = resultText;
                    resultText = tempDiv.textContent || tempDiv.innerText || resultText;
                    
                    appendMessage(resultText, 'ai', selectedModel);
                    
                } else {
                    const errorText = await response.text();
                    console.error('HTTP Error:', errorText);
                    appendMessage(`HTTP Error ${response.status}: Gagal menghubungi server AI`, 'ai', selectedModel);
                }

            } catch (error) {
                console.error("Fetch Error:", error);
                // Cari dan hapus loading message
                const loadingMessages = chatBody.querySelectorAll('.message');
                const lastMessage = loadingMessages[loadingMessages.length - 1];
                if (lastMessage && lastMessage.innerHTML.includes('fa-spinner')) {
                    chatBody.removeChild(lastMessage);
                }
                appendMessage(`Network Error: ${error.message}`, 'ai', selectedModel);
            } finally {
                sendBtn.disabled = false;
                chatBody.scrollTop = chatBody.scrollHeight; 
            }
        }

        function appendMessage(text, sender, model) {
            const chatBody = document.getElementById('chatBody');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}-message`;
            
            // Format teks (basic markdown support)
            let formattedText = text
                .replace(/\*\*(.*?)\*\*/g, '<b>$1</b>') // Bold
                .replace(/\n/g, '<br>'); // Line breaks

            messageDiv.innerHTML = formattedText;
            
            if (sender === 'ai') {
                const modelTag = document.createElement('span');
                modelTag.className = 'message-model-tag';
                modelTag.innerText = model.toUpperCase();
                messageDiv.appendChild(modelTag);
            }
            
            chatBody.appendChild(messageDiv);
            chatBody.scrollTop = chatBody.scrollHeight;
            return messageDiv; 
        }

    </script>
</body>
</html>
